From: Alec Leamas <leamas.alec@gmail.com>
Date: Tue, 28 Aug 2018 23:06:01 +0200
Subject: Build: Use system unarr if available.

Origin: upstream,  https://github.com/OpenCPN/OpenCPN/commit/79ed6ead84c
Applied-Upstream: 5.0.0
---
 plugins/chartdldr_pi/CMakeLists.txt | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/plugins/chartdldr_pi/CMakeLists.txt b/plugins/chartdldr_pi/CMakeLists.txt
index d3c2c66..5ed46cf 100644
--- a/plugins/chartdldr_pi/CMakeLists.txt
+++ b/plugins/chartdldr_pi/CMakeLists.txt
@@ -126,6 +126,16 @@ IF(LibArchive_FOUND)
 ENDIF(LibArchive_FOUND)
 
 INCLUDE_DIRECTORIES(src/unarr/)
+PKG_SEARCH_MODULE(UNARR libunarr unarr)
+IF (UNARR_FOUND AND USE_BUNDLED_LIBS MATCHES "OFF")
+  message (STATUS "Building with system unarr")
+  INCLUDE_DIRECTORIES(${UNARR_INCLUDE_DIR})
+  SET(SRC_UNARR  "")
+ELSE ()
+  message (STATUS "Building with bundled unarr")
+  ADD_LIBRARY(UNARR ${SRC_UNARR})
+  INCLUDE_DIRECTORIES(src/unarr)
+ENDIF ()
 
 IF(TINYXML_FOUND)
  message (STATUS "Chartdldr_pi building with system tinyxml")
@@ -144,6 +154,10 @@ ELSE(TINYXML_FOUND)
 ENDIF(TINYXML_FOUND)
 ADD_DEFINITIONS(-DTIXML_USE_STL)
 
+IF (UNARR_LIBRARIES)
+  TARGET_LINK_LIBRARIES(${PACKAGE_NAME} ${UNARR_LIBRARIES})
+ENDIF()
+
 IF(LibArchive_FOUND)
     TARGET_LINK_LIBRARIES(${PACKAGE_NAME} ${LibArchive_LIBRARIES})
 ELSE(LibArchive_FOUND)
